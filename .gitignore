#!/bin/bash
which gawk > /dev/null || exit 1
test -f .gitignore && grep -q "^#GENERATED" < .gitignore || exit 1
tmp=`mktemp --suffix _gitignore`
awk '/^#GENERATED/ { a = 1 } { if(a>0) { if (a==1) { print $0 }; a++; } else { print $0 } }' < .gitignore > $tmp
awk '/^#GENERATED/ { a = 1 } { if(a>0) { if (a>1) { print $0; }; a++; } }' < .gitignore > $tmp.generated
find -name "*.hs" -exec dirname {} \; -exec echo {} \; | sed 's,^\./,!,' | grep -v "^\." >> $tmp.generated
(cat $tmp; awk -F"/" '{ for(i = 1; i <= 20; i++) { v = gensub(/\..*$/,"","g",$i); printf("%03d%-50s",length(v),v) } print v "==" $0 }' $tmp.generated \
	| sort -n | sed 's,^.*==,,' | uniq | gawk -F"!" '@load "filefuncs"; { if(stat($2,fstat) == 0) { print $0 } }') > .gitignore
exit
#ENDSCRIPT




*
!.gitignore
!Makefile




#GENERATED
!Enqm
!Enqm.hs
!Enqm/Nell
!Enqm/Nell/Sharnell.hs
!Enqm/Nell/Stereonell.hs
!Enqm/Block
!Enqm/Block.hs
!Enqm/Block/Micro.hs
!Enqm/Block/Classic.hs
!Enqm/Model
!Enqm/Model/Migration.hs
!Enqm/Model/Cancellation.hs
!Enqm/Model/Prolongation.hs
!Enqm/Ecology
!Enqm/Ecology/Checking.hs
!Enqm/Ecology/Filtring.hs
!Enqm/Ecology/Sharding.hs
!Enqm/Ecology/Duplication.hs
!Enqm/Network
!Enqm/Network.hs
!Enqm/Network/Receiving
!Enqm/Network/Receiving.hs
!Enqm/Network/Receiving/Block
!Enqm/Network/Receiving/Block.hs
!Enqm/Network/Receiving/Block/Micro.hs
!Enqm/Network/Receiving/Block/Classic.hs
!Enqm/Network/Receiving/Transaction
!Enqm/Network/Receiving/Transaction.hs
!Enqm/Network/Receiving/Transaction/Pending.hs
!Enqm/Network/Receiving/Transaction/Checking.hs
!Enqm/Network/Receiving/Transaction/Security.hs
!Enqm/Network/Transport
!Enqm/Network/Transport/TCP.hs
!Enqm/Network/Transport/UDP.hs
!Enqm/Network/Tunneling
!Enqm/Network/Tunneling/Tor.hs
!Enqm/Network/Distributed
!Enqm/Network/Distributed/DHT.hs
!Enqm/Network/Publication
!Enqm/Network/Publication.hs
!Enqm/Network/Publication/Transaction
!Enqm/Network/Publication/Transaction.hs
!Enqm/Network/Publication/Transaction/DeliveryControl.hs
!Enqm/Network/Publication/Broadcasting.hs
!Enqm/Network/HolePunching
!Enqm/Network/HolePunching/TCP.hs
!Enqm/Network/HolePunching/UDP.hs
!Enqm/Macroblock
!Enqm/Macroblock.hs
!Enqm/Macroblock/Security.hs
!Enqm/Macroblock/Publicators.hs
!Enqm/Statistics
!Enqm/Statistics.hs
!Enqm/Statistics/FuzzyDay.hs
!Enqm/Statistics/Complexity
!Enqm/Statistics/Complexity/ProofOfWork.hs
!Enqm/Statistics/SystemHealth.hs
!Enqm/ProofOfWork
!Enqm/ProofOfWork.hs
!Enqm/ProofOfWork/PvcnHashLoop.hs
!Enqm/ProofOfStake
!Enqm/ProofOfStake.hs
!Enqm/ProofOfStake/Minimal.hs
!Enqm/ProofOfActivity.hs
!Enqm/ProofOfActivity/PowVerification
!Enqm/ProofOfActivity/PowVerification/PvcnHashLoop.hs
!Enqm/DirectAcyclicHyperGraph
!Enqm/DirectAcyclicHyperGraph.hs
!Enqm/DirectAcyclicHyperGraph/PatriciaTreeWithIORef.hs
!Enqm/TransactionsAndSignatures.hs
